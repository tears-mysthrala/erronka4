# Apache configuration for HR Portal

<IfModule mod_rewrite.c>
RewriteEngine On

# Redirect to HTTPS (enabled for production)
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

# Handle Authorization Header
RewriteCond %{HTTP:Authorization} .
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

# Redirect all requests to index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [QSA,L]
</IfModule>

# MIME Types
<IfModule mod_mime.c>
AddType text/css .css
AddType application/javascript .js
AddType font/woff2 .woff2
AddType font/woff .woff
AddType font/ttf .ttf
</IfModule>

# Security Headers
<IfModule mod_headers.c>
Header set X-Content-Type-Options "nosniff"
Header set X-Frame-Options "SAMEORIGIN"
Header set X-XSS-Protection "1; mode=block"
Header set Referrer-Policy "strict-origin-when-cross-origin"
Header set Permissions-Policy "geolocation=(), microphone=(), camera=()"
    
# Content Security Policy (allow external fonts and CDNs)
Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com data:; connect-src 'self' https://zabala-gailetak.infinityfreeapp.com; frame-ancestors 'self'"

# CORS: allow browser clients from the production domain to call the API
Header always set Access-Control-Allow-Origin "https://zabala-gailetak.infinityfreeapp.com"
Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
Header always set Access-Control-Allow-Headers "Authorization, Content-Type, X-Requested-With"
Header always set Access-Control-Allow-Credentials "false"
</IfModule>

# Disable directory browsing
Options -Indexes

ErrorDocument 429 /429.html

<FilesMatch "(composer\.json|composer\.lock|\.env)$">
    Order allow,deny
    Deny from all
</FilesMatch>
