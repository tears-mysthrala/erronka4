#!/bin/bash
# Pentesting web con OWASP ZAP

TARGET_URL="${1:-https://zabala-gailetak.infinityfreeapp.com}"
REPORT_DIR="$(pwd)/reports"
mkdir -p "$REPORT_DIR"

echo "[+] Iniciando escaneo OWASP ZAP"
echo "[+] Target: $TARGET_URL"

# Check if Docker is available
if ! command -v docker &> /dev/null; then
    echo "[!] Docker no disponible, saltando escaneo ZAP"
    exit 1
fi

# Baseline scan (pasivo)
echo "[*] Ejecutando baseline scan..."
docker run --rm \
    -v "$REPORT_DIR:/zap/wrk/:rw" \
    ghcr.io/zaproxy/zaproxy:stable \
    zap-baseline.py \
    -t "$TARGET_URL" \
    -r "zap-baseline-$(date +%Y%m%d).html" \
    -J "zap-baseline-$(date +%Y%m%d).json" \
    -w "zap-baseline-$(date +%Y%m%d).md" 2>&1 || echo "[!] ZAP scan completado con warnings"

echo "[âœ“] Escaneo completo"
echo "[+] Reportes generados en: $REPORT_DIR"
ls -lh "$REPORT_DIR"/zap-baseline-$(date +%Y%m%d).* 2>/dev/null || echo "[!] No se generaron reportes"
