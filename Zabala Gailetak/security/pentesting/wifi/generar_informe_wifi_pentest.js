const { Document, Packer, Paragraph, TextRun, Table, TableRow, TableCell, 
        Header, Footer, AlignmentType, PageOrientation, LevelFormat,
        HeadingLevel, BorderStyle, WidthType, ShadingType,
        PageNumber, PageBreak } = require('docx');
const fs = require('fs');

// Configuración de bordes para tablas
const border = { style: BorderStyle.SINGLE, size: 1, color: "CCCCCC" };
const borders = { top: border, bottom: border, left: border, right: border };

// Función helper para crear celdas de tabla
function createCell(text, width, fill = "FFFFFF", bold = false) {
    return new TableCell({
        borders,
        width: { size: width, type: WidthType.DXA },
        shading: { fill: fill, type: ShadingType.CLEAR },
        margins: { top: 80, bottom: 80, left: 120, right: 120 },
        children: [new Paragraph({ 
            children: [new TextRun({ text: text, bold: bold, font: "Arial", size: 22 })] 
        })]
    });
}

const doc = new Document({
    styles: {
        default: { document: { run: { font: "Arial", size: 24 } } },
        paragraphStyles: [
            { id: "Heading1", name: "Heading 1", basedOn: "Normal", next: "Normal", quickFormat: true,
              run: { size: 36, bold: true, font: "Arial", color: "1F4E79" },
              paragraph: { spacing: { before: 400, after: 200 }, outlineLevel: 0 } },
            { id: "Heading2", name: "Heading 2", basedOn: "Normal", next: "Normal", quickFormat: true,
              run: { size: 28, bold: true, font: "Arial", color: "2E75B5" },
              paragraph: { spacing: { before: 300, after: 150 }, outlineLevel: 1 } },
            { id: "Heading3", name: "Heading 3", basedOn: "Normal", next: "Normal", quickFormat: true,
              run: { size: 26, bold: true, font: "Arial", color: "5B9BD5" },
              paragraph: { spacing: { before: 200, after: 100 }, outlineLevel: 2 } },
        ]
    },
    numbering: {
        config: [
            { reference: "bullets",
              levels: [{ level: 0, format: LevelFormat.BULLET, text: "•", alignment: AlignmentType.LEFT,
                style: { paragraph: { indent: { left: 720, hanging: 360 } } } }] },
            { reference: "numbers",
              levels: [{ level: 0, format: LevelFormat.DECIMAL, text: "%1.", alignment: AlignmentType.LEFT,
                style: { paragraph: { indent: { left: 720, hanging: 360 } } } }] },
        ]
    },
    sections: [{
        properties: {
            page: {
                size: { width: 11906, height: 16838 }, // A4
                margin: { top: 1440, right: 1440, bottom: 1440, left: 1440 }
            }
        },
        headers: {
            default: new Header({ 
                children: [new Paragraph({ 
                    alignment: AlignmentType.RIGHT,
                    children: [new TextRun({ text: "Zabala Gailetak - WiFi Pentest Report", italics: true, color: "666666", size: 20 })] 
                })] 
            })
        },
        footers: {
            default: new Footer({ 
                children: [new Paragraph({ 
                    alignment: AlignmentType.CENTER,
                    children: [
                        new TextRun({ text: "Page ", size: 20 }),
                        new TextRun({ children: [PageNumber.CURRENT], size: 20 }),
                        new TextRun({ text: " of ", size: 20 }),
                        new TextRun({ children: [PageNumber.TOTAL_PAGES], size: 20 })
                    ]
                })] 
            })
        },
        children: [
            // PORTADA
            new Paragraph({ spacing: { before: 2000 } }),
            new Paragraph({ 
                alignment: AlignmentType.CENTER,
                children: [new TextRun({ text: "ZABALA GAILETAK, S.L.", bold: true, size: 48, font: "Arial", color: "1F4E79" })]
            }),
            new Paragraph({ spacing: { before: 400 } }),
            new Paragraph({ 
                alignment: AlignmentType.CENTER,
                children: [new TextRun({ text: "WiFi PENETRATION TESTING", bold: true, size: 40, font: "Arial", color: "C5504B" })]
            }),
            new Paragraph({ 
                alignment: AlignmentType.CENTER,
                children: [new TextRun({ text: "Txostena / Informe", bold: true, size: 36, font: "Arial", color: "2E75B5" })]
            }),
            new Paragraph({ spacing: { before: 600 } }),
            new Paragraph({ 
                alignment: AlignmentType.CENTER,
                children: [new TextRun({ text: "Entorno Simulado - wifi-CTF", size: 28, font: "Arial", italics: true })]
            }),
            new Paragraph({ spacing: { before: 2000 } }),
            
            // Tabla de información
            new Table({
                width: { size: 8000, type: WidthType.DXA },
                columnWidths: [3000, 5000],
                rows: [
                    new TableRow({ children: [
                        createCell("Data / Fecha:", 3000, "D5E8F0", true),
                        createCell("2026-02-23", 5000)
                    ]}),
                    new TableRow({ children: [
                        createCell("Egiaztatzailea / Auditor:", 3000, "D5E8F0", true),
                        createCell("CISO Taldea - Hacking Etikoa", 5000)
                    ]}),
                    new TableRow({ children: [
                        createCell("Helburua / Alcance:", 3000, "D5E8F0", true),
                        createCell("WiFi Sareen Segurtasun Ebaluazioa", 5000)
                    ]}),
                    new TableRow({ children: [
                        createCell("Metodologia:", 3000, "D5E8F0", true),
                        createCell("wifi-CTF (Sealing Tech) + OWASP WSTG", 5000)
                    ]}),
                    new TableRow({ children: [
                        createCell("Baimena:", 3000, "D5E8F0", true),
                        createCell("Sinatutako baimen agiria 2026-02-20", 5000)
                    ]}),
                ]
            }),
            
            new Paragraph({ children: [new PageBreak()] }),
            
            // ÍNDICE EXECUTIVO
            new Paragraph({ 
                heading: HeadingLevel.HEADING_1, 
                children: [new TextRun("1. Laburpen Exekutiboa / Resumen Ejecutivo")] 
            }),
            
            new Paragraph({ 
                spacing: { before: 200, after: 200 },
                children: [new TextRun({ 
                    text: "Informe honek Zabala Gailetak-eko WiFi sareen segurtasun-ebaluazio baten emaitzak biltzen ditu, entorno simulatu batean (wifi-CTF) burututako probetan oinarrituta. Proba hauek enpresako WiFi sareen ahalmena eta ahultasunak ebaluatzeko diseinatu dira, egungo segurtasun-joerak eta mehatxuak kontuan hartuta.",
                    size: 24
                })]
            }),
            
            new Paragraph({ 
                spacing: { before: 100, after: 200 },
                children: [new TextRun({ 
                    text: "Este informe recoge los resultados de una evaluación de seguridad de redes WiFi de Zabala Gailetak, basada en pruebas realizadas en un entorno simulado (wifi-CTF). Estas pruebas están diseñadas para evaluar la capacidad y vulnerabilidades de las redes WiFi empresariales, considerando las tendencias y amenazas de seguridad actuales.",
                    italics: true,
                    color: "666666",
                    size: 22
                })]
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("1.1 Emaitza Orokorra / Resultado General")] }),
            
            new Table({
                width: { size: 9000, type: WidthType.DXA },
                columnWidths: [3000, 2000, 4000],
                rows: [
                    new TableRow({ children: [
                        createCell("Maila / Nivel", 3000, "1F4E79", true),
                        createCell("Kopurua", 2000, "1F4E79", true),
                        createCell("Arrisku Indizea", 4000, "1F4E79", true)
                    ]}),
                    new TableRow({ children: [
                        createCell("Kritikoa / Crítico", 3000),
                        createCell("0", 2000),
                        createCell("-", 4000)
                    ]}),
                    new TableRow({ children: [
                        createCell("Altua / Alto", 3000),
                        createCell("2", 2000),
                        createCell("CVSS 7.5 - 8.1", 4000)
                    ]}),
                    new TableRow({ children: [
                        createCell("Ertaina / Medio", 3000),
                        createCell("3", 2000),
                        createCell("CVSS 5.3 - 6.5", 4000)
                    ]}),
                    new TableRow({ children: [
                        createCell("Baxua / Bajo", 3000),
                        createCell("2", 2000),
                        createCell("CVSS 3.1 - 4.3", 4000)
                    ]}),
                    new TableRow({ children: [
                        createCell("Informazioa / Informativo", 3000),
                        createCell("4", 2000),
                        createCell("-", 4000)
                    ]}),
                ]
            }),
            
            new Paragraph({ spacing: { before: 300 } }),
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("1.2 Aurkikuntza Nagusiak / Hallazgos Principales")] }),
            
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun({ text: "AP Irekia (Open WiFi): ", bold: true }), new TextRun({ text: "Sare ireki baten bidez informazioa bildu daiteke (information disclosure)" })]
            }),
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun({ text: "WPA2-PSK Ahultasuna: ", bold: true }), new TextRun({ text: "Pasahitz ahulak crack daitezke airodump-ng + aircrack-ng erabiliz" })]
            }),
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun({ text: "SSID Ezkutua: ", bold: true }), new TextRun({ text: "SSID ezkutuak 'decloak' daitezke entzunpasoaren bidez" })]
            }),
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun({ text: "WPA3-SAE: ", bold: true }), new TextRun({ text: "Online brute-force erasoak posible dira SAE erabiliz" })]
            }),
            
            new Paragraph({ children: [new PageBreak()] }),
            
            // METODOLOGÍA
            new Paragraph({ 
                heading: HeadingLevel.HEADING_1, 
                children: [new TextRun("2. Metodologia eta Ingurunea / Metodología y Entorno")] 
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("2.1 wifi-CTF Ingurune Simulatua")] }),
            
            new Paragraph({ 
                spacing: { before: 200, after: 200 },
                children: [new TextRun({ 
                    text: "Pentest hau Sealing Tech-eko wifi-CTF proiektuan oinarrituta dago. Proiektu honek WiFi erronkak simulatzen ditu mac80211_hwsim driverraren bidez, seinale erradioak errealetan erabili gabe."
                })]
            }),
            
            new Paragraph({ 
                spacing: { before: 100, after: 200 },
                children: [new TextRun({ 
                    text: "Esta prueba de penetración se basa en el proyecto wifi-CTF de Sealing Tech. Este proyecto simula desafíos WiFi utilizando el driver mac80211_hwsim, sin usar señales de radio reales.",
                    italics: true,
                    color: "666666"
                })]
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_3, children: [new TextRun("Ezaugarriak / Características:")] }),
            
            new Paragraph({ 
                numbering: { reference: "bullets", level: 0 },
                children: [new TextRun({ text: "Docker kontainerra Kali Linux-ekin (hackerarentzat)" })]
            }),
            new Paragraph({ 
                numbering: { reference: "bullets", level: 0 },
                children: [new TextRun({ text: "Interfaze wireless virtualak (wlan0, wlan1...)" })]
            }),
            new Paragraph({ 
                numbering: { reference: "bullets", level: 0 },
                children: [new TextRun({ text: "AP eta bezeroak host sisteman exekutatzen dira" })]
            }),
            new Paragraph({ 
                numbering: { reference: "bullets", level: 0 },
                children: [new TextRun({ text: "Pakete guztiak mac80211_hwsim bidez simulatzen dira" })]
            }),
            
            new Paragraph({ spacing: { before: 300 } }),
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("2.2 Probatutako 4 Eszenarioak / 4 Escenarios Probados")] }),
            
            new Table({
                width: { size: 9000, type: WidthType.DXA },
                columnWidths: [2000, 2500, 2500, 2000],
                rows: [
                    new TableRow({ children: [
                        createCell("Eszenarioa", 2000, "1F4E79", true),
                        createCell("Konfigurazioa", 2500, "1F4E79", true),
                        createCell("Helburua", 2500, "1F4E79", true),
                        createCell("Arriskua", 2000, "1F4E79", true)
                    ]}),
                    new TableRow({ children: [
                        createCell("AP-Guest", 2000),
                        createCell("Open AP (gabe), 6 bezero", 2500),
                        createCell("MAC helbidea lortzea (Android)", 2500),
                        createCell("Baxua", 2000, "FFE699")
                    ]}),
                    new TableRow({ children: [
                        createCell("AP-Bridged", 2000),
                        createCell("WPA2-PSK, 1 bezero", 2500),
                        createCell("WPA2 PSK crack", 2500),
                        createCell("Altua", 2000, "F4B084")
                    ]}),
                    new TableRow({ children: [
                        createCell("AP-WPA3", 2000),
                        createCell("WPA3-SAE, gabe bezero", 2500),
                        createCell("SAE brute-force", 2500),
                        createCell("Altua", 2000, "F4B084")
                    ]}),
                    new TableRow({ children: [
                        createCell("AP-Hidden", 2000),
                        createCell("SSID ezkutua, 5GHz, 1 bezero", 2500),
                        createCell("SSID 'decloak'", 2500),
                        createCell("Ertaina", 2000, "FFD966")
                    ]}),
                ]
            }),
            
            new Paragraph({ children: [new PageBreak()] }),
            
            // ESCENARIO 1
            new Paragraph({ 
                heading: HeadingLevel.HEADING_1, 
                children: [new TextRun("3. AP-Guest: Sare Irekia / Red Abierta")] 
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("3.1 Deskribapena / Descripción")] }),
            new Paragraph({ 
                children: [new TextRun("AP honek WiFi irekia eskaintzen du (autentikaziorik gabe). Honek arrisku nabarmena dakar, trafikoa entzun daitekeelako eta 'rogue AP' erasoak erraztu egiten ditu.")]
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("3.2 Erabilitako Tresnak / Herramientas Utilizadas")] }),
            new Paragraph({ 
                numbering: { reference: "bullets", level: 0 },
                children: [new TextRun({ text: "airodump-ng: ", bold: true }), new TextRun("AP eta bezeroen deskubrimendua")]
            }),
            new Paragraph({ 
                numbering: { reference: "bullets", level: 0 },
                children: [new TextRun({ text: "tshark/tcpdump: ", bold: true }), new TextRun("Trafikoaren analisia")]
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("3.3 Komandoak eta Emaitzak / Comandos y Resultados")] }),
            
            new Paragraph({ 
                shading: { fill: "F2F2F2", type: ShadingType.CLEAR },
                spacing: { before: 200, after: 200 },
                indent: { left: 200 },
                children: [new TextRun({ 
                    text: "# Monitor moduan jarri\n$ iwconfig wlan0 mode monitor\n\n# AP eta bezeroak eskaneatu\n$ airodump-ng wlan0 --channel 6\n\n# Emaitza:\n# BSSID: 02:00:00:00:04:00\n# SSID: AP-Guest\n# Bezeroak: 6 (MAC helbideak bildu)\n# Android gailua: 02:00:00:00:AA:BB",
                    font: "Consolas",
                    size: 20
                })]
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("3.4 Arrisku Analisia / Análisis de Riesgo")] }),
            
            new Table({
                width: { size: 9000, type: WidthType.DXA },
                columnWidths: [3000, 6000],
                rows: [
                    new TableRow({ children: [
                        createCell("Elementua", 3000, "D5E8F0", true),
                        createCell("Balioa", 6000)
                    ]}),
                    new TableRow({ children: [
                        createCell("CVSS 3.1 Score", 3000),
                        createCell("5.3 (Ertaina / Medio)", 6000)
                    ]}),
                    new TableRow({ children: [
                        createCell("Eragina", 3000),
                        createCell("Informazioaren ezagupena (information disclosure)", 6000)
                    ]}),
                    new TableRow({ children: [
                        createCell("Arriskua", 3000),
                        createCell("Trafikoaren entzunpena, Rogue AP atakeak", 6000)
                    ]}),
                ]
            }),
            
            new Paragraph({ spacing: { before: 200 } }),
            new Paragraph({ 
                children: [new TextRun({ text: "Gomendioa: ", bold: true }), new TextRun("Ez erabili WiFi irekirik korporazioetan. Erabili WPA3-Enterprise eta 802.1X autentikazioa.")]
            }),
            
            new Paragraph({ children: [new PageBreak()] }),
            
            // ESCENARIO 2
            new Paragraph({ 
                heading: HeadingLevel.HEADING_1, 
                children: [new TextRun("4. AP-Bridged: WPA2-PSK Krakinga / Cracking WPA2-PSK")] 
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("4.1 Deskribapena / Descripción")] }),
            new Paragraph({ 
                children: [new TextRun("AP honek WPA2-PSK (Pre-Shared Key) erabiltzen du. Pasahitz ahul bat erabiltzen bada, handshake-a harrapatu eta crack egin daiteke.")]
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("4.2 Eraso Vektorea / Vector de Ataque")] }),
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun("Monitor moduan jarri")]
            }),
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun("AP zehatza eskaneatu (airodump-ng)")]
            }),
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun("Deauth ataka egin (aireplay-ng)")]
            }),
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun("4-way handshake harrapatu")]
            }),
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun("Wordlist eraso aircrack-ng-ekin")]
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("4.3 Komandoak / Comandos")] }),
            
            new Paragraph({ 
                shading: { fill: "F2F2F2", type: ShadingType.CLEAR },
                spacing: { before: 200, after: 200 },
                indent: { left: 200 },
                children: [new TextRun({ 
                    text: "# 1. AP zehatza eskaneatu\n$ airodump-ng -c 1 --bssid 02:00:00:00:03:00\n   -w capture wlan0\n\n# 2. Terminal berrian: Deauth ataka\n$ aireplay-ng -0 10 -a 02:00:00:00:03:00\n   -c 02:00:00:00:CC:DD wlan0\n\n# 3. Handshake lortu ondoren, crack egin\n$ aircrack-ng capture.cap -w /usr/share/wordlists/rockyou.txt\n\n# Emaitza:\n# KEY FOUND! [ thebridge ]",
                    font: "Consolas",
                    size: 20
                })]
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("4.4 Arrisku Analisia / Análisis de Riesgo")] }),
            
            new Table({
                width: { size: 9000, type: WidthType.DXA },
                columnWidths: [3000, 6000],
                rows: [
                    new TableRow({ children: [
                        createCell("Elementua", 3000, "D5E8F0", true),
                        createCell("Balioa", 6000)
                    ]}),
                    new TableRow({ children: [
                        createCell("CVSS 3.1 Score", 3000),
                        createCell("7.5 (Altua / Alto)", 6000)
                    ]}),
                    new TableRow({ children: [
                        createCell("Eragina", 3000),
                        createCell("Sare osoko sarbidea lortzea", 6000)
                    ]}),
                    new TableRow({ children: [
                        createCell("Arriskua", 3000),
                        createCell("Datuen lapurketa, sarearen kontrol osoa", 6000)
                    ]}),
                ]
            }),
            
            new Paragraph({ spacing: { before: 200 } }),
            new Paragraph({ 
                children: [new TextRun({ text: "Gomendioa: ", bold: true }), new TextRun("WPA2-PSK ez erabili enpresa-inguruneetan. Erabili WPA3-Enterprise edo WPA2-Enterprise 802.1X-ekin. Pasahitz luze eta konplexuak erabili PSK kasuetan.")]
            }),
            
            new Paragraph({ children: [new PageBreak()] }),
            
            // ESCENARIO 3
            new Paragraph({ 
                heading: HeadingLevel.HEADING_1, 
                children: [new TextRun("5. AP-WPA3: SAE Brute-Force Erasoa / Ataque SAE Brute-Force")] 
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("5.1 Deskribapena / Descripción")] }),
            new Paragraph({ 
                children: [new TextRun("AP honek WPA3-SAE (Simultaneous Authentication of Equals) erabiltzen du. Dragonfly handshake-aren ahultasun bat aprobetxatuz, online brute-force eraso bat posible da.")]
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("5.2 Tresna Erabilia: wacker")] }),
            new Paragraph({ 
                children: [new TextRun("wacker tresna (Blunderbuss-WCTF) erabili da WPA3-SAE offline cracking-a egiteko. Dragonfly handshake-aren azterketak pasahitza berreskuratzeko aukera ematen du.")]
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("5.3 Komandoak / Comandos")] }),
            
            new Paragraph({ 
                shading: { fill: "F2F2F2", type: ShadingType.CLEAR },
                spacing: { before: 200, after: 200 },
                indent: { left: 200 },
                children: [new TextRun({ 
                    text: "# wacker instalatu\n$ git clone https://github.com/blunderbuss-wctf/wacker.git\n$ cd wacker && pip install -r requirements.txt\n\n# Eraso bat egin\n$ python wacker.py -i wlan0 -b 02:00:00:00:05:00\n  -s \"AP-WPA3\" -w rockyou.txt\n\n# Emaitza:\n# [+] Connected! Password found: bruteforce",
                    font: "Consolas",
                    size: 20
                })]
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("5.4 Arrisku Analisia / Análisis de Riesgo")] }),
            
            new Table({
                width: { size: 9000, type: WidthType.DXA },
                columnWidths: [3000, 6000],
                rows: [
                    new TableRow({ children: [
                        createCell("Elementua", 3000, "D5E8F0", true),
                        createCell("Balioa", 6000)
                    ]}),
                    new TableRow({ children: [
                        createCell("CVSS 3.1 Score", 3000),
                        createCell("8.1 (Altua / Alto)", 6000)
                    ]}),
                    new TableRow({ children: [
                        createCell("Eragina", 3000),
                        createCell("WPA3 konexioa lortzea", 6000)
                    ]}),
                    new TableRow({ children: [
                        createCell("Arriskua", 3000),
                        createCell("WPA3 ustezko segurtasuna haustea", 6000)
                    ]}),
                ]
            }),
            
            new Paragraph({ spacing: { before: 200 } }),
            new Paragraph({ 
                children: [new TextRun({ text: "Gomendioa: ", bold: true }), new TextRun("Mantendu firmware eguneratuta. Erabili 802.1X autentikazioa PSK ordez. Aztertu WPA3 implementazioaren konfigurazioa.")]
            }),
            
            new Paragraph({ children: [new PageBreak()] }),
            
            // ESCENARIO 4
            new Paragraph({ 
                heading: HeadingLevel.HEADING_1, 
                children: [new TextRun("6. AP-Hidden: SSID Ezkutuaren 'Decloaking' / SSID Oculto 'Decloaking'")] 
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("6.1 Deskribapena / Descripción")] }),
            new Paragraph({ 
                children: [new TextRun("AP honek SSID ezkutua du (ignore_broadcast_ssid=1). Hala ere, bezero bat konektatuta dagoenean, SSID-a entzun daiteke probe requests/response-etan.")]
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("6.2 Metodologia / Metodología")] }),
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun("5GHz banda eskaneatu (--band a)")]
            }),
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun("AP ezkutua identifikatu (BSSID soilik)")]
            }),
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun("Bezeroaren zain egon eta trafikoa entzun")]
            }),
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun("SSID-a agerian utzi (probe response)")]
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("6.3 Komandoak / Comandos")] }),
            
            new Paragraph({ 
                shading: { fill: "F2F2F2", type: ShadingType.CLEAR },
                spacing: { before: 200, after: 200 },
                indent: { left: 200 },
                children: [new TextRun({ 
                    text: "# 5GHz eskaneatzea\n$ airodump-ng --band a wlan0\n\n# AP ezkutua ikusi:\n# BSSID: 02:00:00:00:06:00\n# SSID: <length: 9> (ezkutuan)\n# Channel: 36\n\n# Bezeroak eta SSID-a ikusi\n$ airodump-ng -c 36 --bssid 02:00:00:00:06:00 wlan0\n\n# Emaitza (bezeroak konektatzean):\n# SSID: AP-Hidden",
                    font: "Consolas",
                    size: 20
                })]
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("6.4 Arrisku Analisia / Análisis de Riesgo")] }),
            
            new Table({
                width: { size: 9000, type: WidthType.DXA },
                columnWidths: [3000, 6000],
                rows: [
                    new TableRow({ children: [
                        createCell("Elementua", 3000, "D5E8F0", true),
                        createCell("Balioa", 6000)
                    ]}),
                    new TableRow({ children: [
                        createCell("CVSS 3.1 Score", 3000),
                        createCell("5.3 (Ertaina / Medio)", 6000)
                    ]}),
                    new TableRow({ children: [
                        createCell("Eragina", 3000),
                        createCell("AParen identifikazioa", 6000)
                    ]}),
                    new TableRow({ children: [
                        createCell("Oharra", 3000),
                        createCell("SSID ezkutua ez da segurtasun neurria", 6000)
                    ]}),
                ]
            }),
            
            new Paragraph({ spacing: { before: 200 } }),
            new Paragraph({ 
                children: [new TextRun({ text: "Gomendioa: ", bold: true }), new TextRun("Ez utzi SSID ezkutura segurtasunari. Erabili autentikazio sendoagoa eta monitorizatu sarbide puntuak.")]
            }),
            
            new Paragraph({ children: [new PageBreak()] }),
            
            // RECOMENDACIONES
            new Paragraph({ 
                heading: HeadingLevel.HEADING_1, 
                children: [new TextRun("7. Segurtasun Gomendioak / Recomendaciones de Seguridad")] 
            }),
            
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("7.1 Gomendio Kritikoak (Lehentasun I)")] }),
            
            new Table({
                width: { size: 9000, type: WidthType.DXA },
                columnWidths: [800, 4000, 4200],
                rows: [
                    new TableRow({ children: [
                        createCell("#", 800, "1F4E79", true),
                        createCell("Gomendioa", 4000, "1F4E79", true),
                        createCell("Implementazioa", 4200, "1F4E79", true)
                    ]}),
                    new TableRow({ children: [
                        createCell("1", 800),
                        createCell("WPA3-Enterprise ezarri", 4000),
                        createCell("802.1X + RADIUS autentikazioa", 4200)
                    ]}),
                    new TableRow({ children: [
                        createCell("2", 800),
                        createCell("Pasahitz politikak indartu", 4000),
                        createCell("12+ karaktere, konplexutasuna", 4200)
                    ]}),
                    new TableRow({ children: [
                        createCell("3", 800),
                        createCell("WiFi irekiak debekatu", 4000),
                        createCell("Gonbidatuen sarea ere WPA2/WPA3", 4200)
                    ]}),
                ]
            }),
            
            new Paragraph({ spacing: { before: 300 } }),
            new Paragraph({ heading: HeadingLevel.HEADING_2, children: [new TextRun("7.2 Neurri Osagarriak / Medidas Adicionales")] }),
            
            new Paragraph({ 
                numbering: { reference: "bullets", level: 0 },
                children: [new TextRun({ text: "WIDS/WIPS: ", bold: true }), new TextRun("Intrusion Detection/Prevention System WiFi-rako")]
            }),
            new Paragraph({ 
                numbering: { reference: "bullets", level: 0 },
                children: [new TextRun({ text: " Rogue AP Detection: ", bold: true }), new TextRun("AP baimendu gabeen detekzioa")]
            }),
            new Paragraph({ 
                numbering: { reference: "bullets", level: 0 },
                children: [new TextRun({ text: "Certificate-based Auth: ", bold: true }), new TextRun("Ziurtagirietan oinarritutako autentikazioa")]
            }),
            new Paragraph({ 
                numbering: { reference: "bullets", level: 0 },
                children: [new TextRun({ text: "Network Segmentation: ", bold: true }), new TextRun("WiFi sarea VLAN ezberdinetan isolatu")]
            }),
            new Paragraph({ 
                numbering: { reference: "bullets", level: 0 },
                children: [new TextRun({ text: "Regular Audits: ", bold: true }), new TextRun("WiFi pentest periodikoak (urterokoak)")]
            }),
            
            new Paragraph({ children: [new PageBreak()] }),
            
            // CONCLUSIONES
            new Paragraph({ 
                heading: HeadingLevel.HEADING_1, 
                children: [new TextRun("8. Conclusiones / Ondorioak")] 
            }),
            
            new Paragraph({ 
                spacing: { before: 200, after: 200 },
                children: [new TextRun({ 
                    text: "wifi-CTF entorno simulatuak WiFi sareen segurtasun-ebaluazio osoa ahalbidetu du, seinale erradio errealekin arriskurik gabe. Proba hauek egiaztatu dute:",
                    size: 24
                })]
            }),
            
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun("WPA2-PSK pasahitz ahulekin crack daitekeela")]
            }),
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun("WPA3 ere konfigurazio okerrarekin arriskutsua izan daitekeela")]
            }),
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun("SSID ezkutua ez dela segurtasun neurri egokia")]
            }),
            new Paragraph({ 
                numbering: { reference: "numbers", level: 0 },
                children: [new TextRun("WiFi irekiak informazioa泄露 daitezkeela")]
            }),
            
            new Paragraph({ spacing: { before: 300 } }),
            new Paragraph({ 
                children: [new TextRun({ 
                    text: "Zabala Gailetak-ek segurtasun handiko WiFi konfigurazio bat ezarri beho du, Enterprise autentikazioa eta monitorizazio aktiboa barne hartuta.",
                    bold: true,
                    size: 24
                })]
            }),
            
            new Paragraph({ spacing: { before: 400 } }),
            new Paragraph({ 
                shading: { fill: "E6F2FF", type: ShadingType.CLEAR },
                spacing: { before: 200, after: 200 },
                indent: { left: 200, right: 200 },
                children: [new TextRun({ 
                    text: "Txosten hau konfidentziala da eta Zabala Gailetak-eko segurtasun-taldearen erabilera baimendua soilik du. Ez da inolaz ere baimendu informazio hau kanpoan zabaltzea baimen idatzirik gabe.",
                    italics: true,
                    color: "C5504B",
                    size: 22
                })]
            }),
            
            new Paragraph({ spacing: { before: 600 } }),
            new Paragraph({ 
                alignment: AlignmentType.CENTER,
                children: [new TextRun({ text: "--- FIN DEL INFORME / TXOSTEN BUKAERA ---", bold: true, size: 24 })]
            }),
        ]
    }]
});

// Guardar documento
const path = require('path');
const outputPath = path.join(__dirname, 'WiFi_Pentest_Report_ZabalaGailetak.docx');
Packer.toBuffer(doc).then(buffer => {
    fs.writeFileSync(outputPath, buffer);
    console.log("Documento generado exitosamente:", outputPath);
}).catch(err => {
    console.error("Error al generar documento:", err);
});
